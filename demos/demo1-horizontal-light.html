<!DOCTYPE html>
<html>
  <head>
    <title>IDALEON</title>

    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        display: flex;
        border-radius: 4px;
        flex-direction: column;
      }
      #nav-body-views {
        z-index: 1;
      }
      #flag {
        width: 100%;
        height: 9px;
        background-color: rgb(23, 23, 23);
        z-index: 4;
      }
      #bar {
        z-index: 3;
      }

      .animate {
      }
      #nav-body-ctrls {
      }
      #nav-body-tabs {
      }
    </style>
    <link
      rel="stylesheet"
      type="text/css"
      href="../themes/material-light.css"
    />
    <link rel="stylesheet" type="text/css" href="../themes/slider.css" />

    <script type="text/javascript" src="./jquery.js"></script>
  </head>

  <body>
    <div class="animate">
      <div id="bar"></div>

      <div id="nav-body-ctrls">
        <!-- address -->
      </div>

      <div id="nav-body-tabs">
        <!-- tabs -->
      </div>
      <div id="flag"></div>
      <div id="drag"></div>
    </div>

    <div id="nav-body-views">
      <!-- view -->
    </div>

    <script>
      $(document).bind("drop dragover", function(e) {
        e.preventDefault();
      });
      var ignore = false;
      var el = document.getElementsByClassName("animate");
      el.onmousedown = function(e) {
        if (window.event.stopPropagation) window.event.stopPropagation();
        window.event.cancelBubble = true;
        e.cancelBubble = true;
      };
      function altop() {
        const { BrowserWindow } = require("electron").remote;
        var win = BrowserWindow.getFocusedWindow();
        var top = win.isAlwaysOnTop();
        if (top == true) {
          win.setAlwaysOnTop(false);
          top = false;

          //  alert("не top");
        } else {
          win.setAlwaysOnTop(true);
          top = true;

          // alert("top");
        }
        ipcRenderer.send("change_icon");
      }
      //change_icon
      function mouse_ignore() {
        const { BrowserWindow } = require("electron").remote;
        var win = BrowserWindow.getFocusedWindow();
        if (ignore == true) {
          win.setIgnoreMouseEvents(false);
          ignore = false;
          ipcRenderer.send("ignore", false);
          $(".animate").removeClass("transition");
        } else {
          win.setIgnoreMouseEvents(true);
          ignore = true;
          ipcRenderer.send("noty", "Unlock: CTRL + E / and tray");
          ipcRenderer.send("ignore", true);
          $(".animate").addClass("transition");
        }
        ipcRenderer.send("change_icon");
      }
      $(window).load(function() {
        const enav = new (require("../index.js"))();
        enav.newTab(`file:///${__dirname}/mainPage.html`, {
          icon: "../img/site-icon.png",
          title: "Local file",
          close: "false"
        });
      });
    </script>
    <script></script>
    <script>
      var bar = document.getElementById("bar");
      const electronTitlebarWindows = require("electron-titlebar-windows");
      const { remote } = require("electron");
      const { ipcRenderer } = require("electron");
      var zoom = 0;
      // ipc
      function onZoomChange() {
        var Value = $("#zoom_slider").val();
        console.log(Value);
        change(Value);
      }
      function change(value) {
        const webview = document.querySelector("webview");
        webview.setZoomFactor(value);
        zoom = value;
      }
      function zoomIn() {
        const webview = document.querySelector("webview");
        let actualZoom = zoom;
        if (actualZoom == null) {
          actualZoom = 1;
        }
        webview.setZoomFactor(actualZoom + 1);
        zoom = actualZoom + 1;
      }

      function zoomOut() {
        const webview = document.querySelector("webview");
        let actualZoom = zoom;
        if (actualZoom == null) {
          actualZoom = 1;
        }
        webview.setZoomFactor(actualZoom - 1);
        zoom = actualZoom - 1;
      }
      //disable_skip
      ipcRenderer.on("change_opacity", (event, arg) => {
        changeOpacity(arg);
        change_input_value(arg);
      });
      ipcRenderer.on("remove_class", (event, arg) => {
        $(".animate").removeClass("transition");
      });
      ipcRenderer.on("add_class", (event, arg) => {
        $(".animate").addClass("transition");
      });
      ipcRenderer.on("disable_skip", (event, arg) => {
        const { BrowserWindow } = require("electron").remote;
        var win = BrowserWindow.getFocusedWindow();
        if ((arg = "false")) {
          console.log("b false");

          ignore = false;
        } else {
          console.log("a");

          ignore = true;
        }
      });
      ipcRenderer.on("disable_skip_tray", (event, arg) => {
        ignore = false;
      });
      ipcRenderer.on("web_view_range", (event, arg) => {
        const webview = document.querySelector("webview");
        const { webFrame } = require("electron");

        console.log(arg); // prints "pong"
        if (arg == "plus") {
          //  webFrame.setZoomFactor(a++);
          zoomIn();
          // var a = webFrame.getZoomLevel();
        } else {
          // webFrame.setZoomFactor(a--);
          zoomOut();
        }
      });
      ipcRenderer.on("drag", (event, arg) => {
        const { BrowserWindow } = require("electron").remote;
        var win = BrowserWindow.getFocusedWindow();
        const webview = document.querySelector("webview");
        var area = document.getElementById("nav-body-views");
        //  win.focus();
        //   var area = document.body;
        if (arg == "true") {
          area.setAttribute("style", "-webkit-app-region: drag;");
          //  win.reload();

          webview.reload();
        } else {
          area.setAttribute("style", "-webkit-app-region: no-drag;");
          //  win.reload();

          webview.reload();
        }
      });
      //

      /** Options */

      let titlebar = new electronTitlebarWindows({
        darkMode: false,
        color: "rgb(220, 200, 200)",
        backgroundColor: "rgb(24,22,23)",
        draggable: true,
        fullscreen: false
      });
      /**
       * DOM
       */
      titlebar.appendTo(bar);
      /** Event#close */
      titlebar.on("close", () => {
        console.info("close");
        remote.getCurrentWindow().close();
      });
      /** Event#fullscreen */
      titlebar.on("fullscreen", () => {
        console.info("fullscreen");
        remote.getCurrentWindow().setFullScreen(true);
      });
      /** Event#minimize */
      titlebar.on("minimize", () => {
        console.info("minimize");
        remote.getCurrentWindow().minimize();
      });
      /** Event#maximize */
      titlebar.on("maximize", () => {
        console.info("maximize");
        remote.getCurrentWindow().setFullScreen(false);
        remote.getCurrentWindow().maximize();
      });
    </script>
    <script>
      /* production */
      // const enav = new (require('electron-navigation'))();

      /* development */

      // create a new tab to www.google.com

      function onChange() {
        var opacityValue = $("#slider").val();
        changeOpacity(opacityValue);
      }
      // $("#slider").change(function() {
      //  var opacityValue = $(this).val();
      //  changeOpacity(opacityValue);
      // });

      function changeOpacity(opacity) {
        $("#nav-body-views").css("opacity", opacity);
      }
      function change_input_value(value) {
        document.getElementById("slider").value = value;
      }
    </script>
  </body>
</html>
